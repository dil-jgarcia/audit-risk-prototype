<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GovernAI Agent</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            background: #fff;
            color: #1a1a1a;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* ── Top Bar ── */
        .top-bar {
            height: 48px;
            background: #fff;
            border-bottom: 1px solid #E5E5E5;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            flex-shrink: 0;
        }

        .top-bar-side {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100px;
        }
        .top-bar-side.right { justify-content: flex-end; }

        .hamburger {
            width: 20px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
        }
        .hamburger span { height: 2px; background: #333; border-radius: 1px; }

        .top-bar-title-wrapper {
            position: relative;
        }

        .top-bar-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
            font-weight: 600;
            color: #111;
            cursor: pointer;
            user-select: none;
            padding: 5px 10px;
            border-radius: 8px;
            transition: background 0.12s;
        }
        .top-bar-title:hover { background: #F5F5F5; }
        .top-bar-title svg { color: #888; }

        .title-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            border: 1px solid #E0E0E0;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.10);
            min-width: 200px;
            z-index: 200;
            overflow: hidden;
        }
        .title-dropdown.open { display: block; }

        .title-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            cursor: pointer;
            transition: background 0.12s, color 0.12s;
        }
        .title-dropdown-item:hover {
            background: #EEF2FF;
            color: #2563EB;
        }
        .title-dropdown-item:hover svg { color: #2563EB; }
        .title-dropdown-item svg { color: #8B5CF6; flex-shrink: 0; transition: color 0.12s; }
        .title-dropdown-item.active {
            background: #EEF2FF;
            color: #2563EB;
            font-weight: 600;
        }
        .title-dropdown-item.active svg { color: #2563EB; }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #555;
        }
        .icon-btn:hover { background: #F5F5F5; }
        .icon-btn svg { width: 18px; height: 18px; }

        /* ── Body Layout ── */
        .body-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ── Sidebar ── */
        .sidebar {
            width: 52px;
            background: #fff;
            border-right: 1px solid #E5E5E5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 14px 0;
            gap: 4px;
            flex-shrink: 0;
        }

        .sidebar-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #999;
        }
        .sidebar-btn:hover { background: #F5F5F5; color: #555; }
        .sidebar-btn svg { width: 18px; height: 18px; }

        /* ── Chat Area ── */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #fff;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 36px 48px;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        /* ── User Message ── */
        .msg-user {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
        }

        .msg-user-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #999;
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #F0A0A0, #C06060);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .msg-user-bubble {
            background: #F7F7F7;
            border: 1px solid #EFEFEF;
            border-radius: 14px 14px 4px 14px;
            padding: 14px 18px;
            font-size: 14px;
            line-height: 1.65;
            color: #222;
            max-width: 560px;
        }

        /* ── AI Message ── */
        .msg-ai {
            display: flex;
            flex-direction: column;
            gap: 14px;
            max-width: 700px;
        }

        .msg-ai-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #E53935, #D32F2F);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 13px;
            flex-shrink: 0;
        }

        .ai-name {
            font-size: 13px;
            font-weight: 600;
            color: #222;
        }

        .ai-time {
            font-size: 12px;
            color: #BBB;
        }

        .msg-ai-content {
            font-size: 14px;
            line-height: 1.75;
            color: #333;
            padding-left: 36px;
        }

        .msg-ai-content p { margin-bottom: 12px; }
        .msg-ai-content strong { font-weight: 700; color: #111; }

        .msg-ai-content ol {
            padding-left: 20px;
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .msg-ai-content ul {
            padding-left: 18px;
            margin-bottom: 12px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .msg-ai-content li { color: #444; }

        .related-context-title {
            font-size: 13px;
            font-weight: 700;
            color: #333;
            margin-bottom: 6px;
        }

        /* Sources */
        .sources {
            padding-left: 36px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .sources-label {
            font-size: 11px;
            font-weight: 700;
            color: #BBB;
            letter-spacing: 0.6px;
            text-transform: uppercase;
        }

        .sources-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .source-chip {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: #F5F5F5;
            border: 1px solid #E8E8E8;
            border-radius: 6px;
            font-size: 12px;
            color: #555;
            cursor: pointer;
            transition: border-color 0.12s;
        }
        .source-chip:hover { border-color: #CCC; background: #F0F0F0; }
        .source-chip svg { width: 12px; height: 12px; color: #999; flex-shrink: 0; }

        /* Action buttons */
        .msg-actions {
            display: flex;
            align-items: center;
            gap: 2px;
            padding-left: 36px;
        }

        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #CCC;
            transition: all 0.12s;
        }
        .action-btn:hover { background: #F5F5F5; color: #777; }
        .action-btn svg { width: 15px; height: 15px; }

        /* ── Input Section ── */
        .input-section {
            flex-shrink: 0;
            padding: 0 48px 20px;
        }

        .gradient-divider {
            height: 1px;
            background: linear-gradient(90deg, #FF6B6B 0%, #FF9F43 25%, #54A0FF 50%, #8B5CF6 75%, #00D2D3 100%);
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .input-box {
            border: 1px solid #E0E0E0;
            border-radius: 14px;
            padding: 14px 16px 10px;
            background: #FAFAFA;
            transition: border-color 0.15s;
        }
        .input-box:focus-within {
            border-color: #C8C8C8;
            background: #fff;
        }

        .input-field {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 14px;
            color: #333;
            font-family: inherit;
            resize: none;
            outline: none;
            line-height: 1.5;
            min-height: 22px;
            max-height: 120px;
            overflow-y: auto;
        }
        .input-field::placeholder { color: #C0C0C0; }

        .input-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .input-left {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .input-pill-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            color: #777;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.12s;
        }
        .input-pill-btn:hover { background: #EFEFEF; }
        .input-pill-btn svg { width: 15px; height: 15px; flex-shrink: 0; }

        .input-right {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .send-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #E8E8E8;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #AAA;
            transition: all 0.15s;
        }
        .send-btn.ready {
            background: #111;
            color: #fff;
        }
        .send-btn svg { width: 14px; height: 14px; }

        .disclaimer {
            text-align: center;
            font-size: 12px;
            color: #C8C8C8;
            margin-top: 10px;
        }
        .disclaimer a { color: #AAA; text-decoration: none; }
        .disclaimer a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<!-- Top Bar -->
<header class="top-bar">
    <div class="top-bar-side">
        <div class="hamburger">
            <span></span><span></span><span></span>
        </div>
    </div>

    <div class="top-bar-title-wrapper">
        <div class="top-bar-title" id="titleBtn">
            AI Audit Expert
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
        </div>
        <div class="title-dropdown" id="titleDropdown">
            <div class="title-dropdown-item" data-expert="Audit">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                AI Audit Expert
            </div>
            <div class="title-dropdown-item" data-expert="Risk">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                AI Enterprise Risk Expert
            </div>
            <div class="title-dropdown-item" data-expert="Cyber">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                AI Cyber Expert
            </div>
        </div>
    </div>

    <div class="top-bar-side right">
        <div class="icon-btn" title="Close" onclick="window.location.href='audit-risk-prep.html'">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </div>
    </div>
</header>

<!-- Body -->
<div class="body-layout">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-btn" title="Documents">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        </div>
        <div class="sidebar-btn" title="History">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
        </div>
    </aside>

    <!-- Chat -->
    <div class="chat-area">
        <div class="messages" id="messages">

            <!-- Empty state (shown when no question) -->
            <div id="emptyState" style="display:none; flex:1; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:60px 24px;">
                <div style="width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#E53935,#D32F2F);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:22px;margin:0 auto 20px;">D</div>
                <div style="font-size:20px;font-weight:700;color:#111;margin-bottom:8px;" id="emptyTitle">AI Audit Expert</div>
                <div style="font-size:14px;color:#999;max-width:360px;line-height:1.6;" id="emptySubtitle">Ask your Audit Expert anything about the board materials, risk flags, or financial disclosures.</div>
            </div>

            <!-- User message -->
            <div class="msg-user" id="msgUserWrapper">
                <div class="msg-user-meta">
                    <span>Sarah McKinsey</span>
                    <span>03:13 PM</span>
                    <div class="user-avatar">SM</div>
                </div>
                <div class="msg-user-bubble" id="userQuestion">
                    Why did revenue recognition in the final two weeks of Q4 reach 23% of quarterly revenue when the 3-year historical norm is 8–10%? Can management provide signed contracts and delivery confirmations for the five largest Q4 deals?
                </div>
            </div>

            <!-- AI message -->
            <div class="msg-ai">
                <div class="msg-ai-meta">
                    <div class="ai-avatar">D</div>
                    <span class="ai-name" id="expertLabel">AI Risk Expert</span>
                    <span class="ai-time">03:15 PM</span>
                </div>
                <div class="msg-ai-content" id="aiResponseContent">
                    <p>This is a significant anomaly requiring escalation. A 23% final-week concentration — nearly 3× the historical 8–10% norm — is one of the most reliable indicators of potential revenue manipulation. Here's what to focus on:</p>
                    <p><strong>Key concerns requiring documentation:</strong></p>
                    <ol>
                        <li><strong>Contract modifications:</strong> Request executed contracts for the five largest Q4 deals. Look for side letters or verbal terms not captured in the formal agreement.</li>
                        <li><strong>Delivery confirmation:</strong> Verify the specific date control transferred under ASC 606 for each deal. Management's assertion is not a verified fact.</li>
                        <li><strong>Return rights and acceptance clauses:</strong> Any deal with acceptance provisions or extended return windows may not qualify for Q4 recognition.</li>
                        <li><strong>Q1 reversals:</strong> Ask internal audit to pull early Q1 credit memos. Channel stuffing typically shows up in subsequent-period reversals.</li>
                    </ol>
                    <p>The SEC consistently flags quarter-end revenue spikes as a fraud indicator. Under Armour's $408M SEC settlement involved exactly this pattern.</p>
                </div>
                <div class="sources">
                    <div class="sources-label">Sources</div>
                    <div class="sources-chips" id="sourcesChips">
                        <div class="source-chip">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            Q4 Financial Statements, p. 8
                        </div>
                        <div class="source-chip">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            Q4 Revenue Analysis Deck, p. 4
                        </div>
                        <div class="source-chip">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                            Internal Controls Assessment, p. 16
                        </div>
                    </div>
                </div>
                <div class="msg-actions">
                    <div class="action-btn" title="Helpful">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3H14z"/><path d="M7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                    </div>
                    <div class="action-btn" title="Not helpful">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3H10z"/><path d="M17 2h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/></svg>
                    </div>
                    <div class="action-btn" title="Copy">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    </div>
                </div>
            </div>

        </div>

        <!-- Input -->
        <div class="input-section">
            <div class="gradient-divider"></div>
            <div class="input-box">
                <textarea class="input-field" id="inputField" placeholder="Ask the Audit Expert about financial statements, controls, or fraud indicators…" rows="1"></textarea>
                <div class="input-actions">
                    <div class="input-left">
                        <div class="input-pill-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
                        </div>
                        <div class="input-pill-btn">
                            Tools
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </div>
                    </div>
                    <div class="input-right">
                        <div class="input-pill-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                        </div>
                        <button class="send-btn" id="sendBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="disclaimer">AI-generated content may have inaccuracies. <a href="#">Learn more</a></div>
        </div>
    </div>
</div>

<script>
    // Per-expert Q&A content — questions match the home page suggested questions
    const expertContent = {
        Audit: {
            question: 'Why did revenue recognition in the final two weeks of Q4 reach 23% of quarterly revenue when the 3-year historical norm is 8–10%? Can management provide signed contracts and delivery confirmations for the five largest Q4 deals?',
            responseHtml: `<p>This is a significant anomaly requiring escalation. A 23% final-week concentration — nearly 3× the historical 8–10% norm — is one of the most reliable indicators of potential revenue manipulation. Here's what to focus on:</p>
                    <p><strong>Key concerns requiring documentation:</strong></p>
                    <ol>
                        <li><strong>Contract modifications:</strong> Request executed contracts for the five largest Q4 deals. Look for side letters or verbal terms not captured in the formal agreement.</li>
                        <li><strong>Delivery confirmation:</strong> Verify the specific date control transferred under ASC 606 for each deal. Management's assertion is not a verified fact.</li>
                        <li><strong>Return rights and acceptance clauses:</strong> Any deal with acceptance provisions or extended return windows may not qualify for Q4 recognition.</li>
                        <li><strong>Q1 reversals:</strong> Ask internal audit to pull early Q1 credit memos. Channel stuffing typically shows up in subsequent-period reversals.</li>
                    </ol>
                    <p>The SEC consistently flags quarter-end revenue spikes as a fraud indicator. Under Armour's $408M SEC settlement involved exactly this pattern.</p>`,
            sources: ['Q4 Financial Statements, p. 8', 'Q4 Revenue Analysis Deck, p. 4', 'Internal Controls Assessment, p. 16']
        },
        Risk: {
            question: 'The ERM dashboard shows three risks currently rated above board-approved appetite thresholds. What is the status of mitigation plans for each, and have any risk owners or timelines changed since the Q3 board meeting?',
            responseHtml: `<p>Three risks above board-approved appetite is a governance failure that requires direct board attention — not just a management status update. Here's what to probe:</p>
                    <p><strong>What the board needs to understand:</strong></p>
                    <ol>
                        <li><strong>Escalation accountability:</strong> How many quarters have these three risks been above appetite without board-level escalation? The obligation to surface breaches rests with management — who owns that?</li>
                        <li><strong>Mitigation plan specifics:</strong> Request the risk owner for each, the committed remediation timeline, and the metric that will confirm the risk is back within appetite.</li>
                        <li><strong>Cascading scenarios:</strong> Supplier concentration, cyber incident response, and customer concentration are potentially interconnected. A supply disruption could accelerate customer losses. Has management modeled second-order effects?</li>
                        <li><strong>Appetite recalibration:</strong> If near-term mitigation isn't feasible, the board should consciously decide whether the appetite statement needs revision — that's a board decision, not a management default.</li>
                    </ol>
                    <p>SVB's collapse illustrated exactly this failure: concentration risks above appetite, acknowledged in risk registers, with perpetually overdue mitigation plans.</p>`,
            sources: ['Risk Register & Heat Map, p. 7', 'Q3 Board Meeting Minutes', 'ERM Dashboard Q4 2025']
        },
        Cyber: {
            question: 'Of the 8 ERP users identified with conflicting access roles in the SOX assessment, how many have been remediated, and what compensating controls are in place for those that remain? When is full remediation expected?',
            responseHtml: `<p>Segregation of duties violations in a newly implemented ERP are among the highest-risk IT control findings an audit committee can encounter. The second consecutive quarter without remediation is the most serious concern. Here's what to probe:</p>
                    <p><strong>Why this matters beyond compliance:</strong></p>
                    <ol>
                        <li><strong>Fraud exposure:</strong> Each of the 8 users with both initiation and approval rights represents an unmitigated fraud pathway — fictitious transactions, unauthorized payments, or concealed errors.</li>
                        <li><strong>Compensating controls specifics:</strong> Management will reference compensating controls. Ask precisely what they are — enhanced monitoring, supervisor review? Assess whether they actually close the gap.</li>
                        <li><strong>No access reviews since go-live:</strong> Six months without a provisioning review means the current access profile may be significantly worse than when the finding was first identified. Request a current access report.</li>
                        <li><strong>Remediation deadline:</strong> Get a specific date, not "in progress." Two consecutive quarters suggests this isn't being prioritized — direct board attention typically accelerates resolution.</li>
                    </ol>
                    <p>Multiple high-profile fraud cases — including Wirecard — involved ERP access control failures where SOD violations went unremediated for quarters.</p>`,
            sources: ['Internal Controls Assessment, p. 22–24', 'IT SOX Testing Results', 'ERP Access Report Q4 2025']
        }
    };

    const sourceIconSvg = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>`;

    // Read URL params
    const params = new URLSearchParams(window.location.search);
    let currentExpert = params.get('expert') || 'Audit';
    const hasQuestion = !!params.get('expert'); // came from home page

    // Show messages or empty state
    if (hasQuestion) {
        document.getElementById('msgUserWrapper').style.display = '';
        document.querySelector('.msg-ai').style.display = '';
        document.getElementById('emptyState').style.display = 'none';
    } else {
        document.getElementById('msgUserWrapper').style.display = 'none';
        document.querySelector('.msg-ai').style.display = 'none';
        document.getElementById('emptyState').style.display = 'flex';
    }

    function setExpert(expertKey) {
        currentExpert = expertKey;
        const labels = { Audit: 'AI Audit Expert', Risk: 'AI Enterprise Risk Expert', Cyber: 'AI Cyber Expert' };
        const subtitles = {
            Audit: 'Ask your Audit Expert anything about the board materials, risk flags, or financial disclosures.',
            Risk: 'Ask your Enterprise Risk Expert about risk appetite, exposure levels, or mitigation strategies.',
            Cyber: 'Ask your Cyber Expert about IT controls, access management, or cybersecurity governance.'
        };
        const placeholders = {
            Audit: 'Ask the Audit Expert about financial statements, controls, or fraud indicators…',
            Risk: 'Ask the Enterprise Risk Expert about risk appetite, exposure, or mitigation strategies…',
            Cyber: 'Ask the Cyber Expert about IT controls, access management, or cybersecurity governance…'
        };

        const label = labels[expertKey] || 'AI Audit Expert';
        document.getElementById('expertLabel').textContent = label;
        document.getElementById('titleBtn').childNodes[0].textContent = label + ' ';
        const emptyTitle = document.getElementById('emptyTitle');
        if (emptyTitle) emptyTitle.textContent = label;
        const sub = document.getElementById('emptySubtitle');
        if (sub) sub.textContent = subtitles[expertKey] || subtitles.Audit;
        const field = document.getElementById('inputField');
        if (field) field.placeholder = placeholders[expertKey] || placeholders.Audit;

        // Swap Q&A content to match the selected expert
        const content = expertContent[expertKey];
        if (content) {
            document.getElementById('userQuestion').textContent = content.question;
            document.getElementById('aiResponseContent').innerHTML = content.responseHtml;
            document.getElementById('sourcesChips').innerHTML = content.sources
                .map(s => `<div class="source-chip">${sourceIconSvg}${s}</div>`).join('');
            // Show messages when expert is switched
            document.getElementById('msgUserWrapper').style.display = '';
            document.querySelector('.msg-ai').style.display = '';
            document.getElementById('emptyState').style.display = 'none';
        }

        document.querySelectorAll('.title-dropdown-item').forEach(item => {
            item.classList.toggle('active', item.dataset.expert === expertKey);
        });
    }

    setExpert(currentExpert);

    // Title dropdown
    const titleBtn = document.getElementById('titleBtn');
    const titleDropdown = document.getElementById('titleDropdown');

    titleBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        titleDropdown.classList.toggle('open');
    });

    document.querySelectorAll('.title-dropdown-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.stopPropagation();
            setExpert(item.dataset.expert);
            titleDropdown.classList.remove('open');
        });
    });

    document.addEventListener('click', () => {
        titleDropdown.classList.remove('open');
    });

    // Send button activation
    const inputField = document.getElementById('inputField');
    const sendBtn = document.getElementById('sendBtn');

    inputField.addEventListener('input', () => {
        sendBtn.classList.toggle('ready', inputField.value.trim().length > 0);
        inputField.style.height = 'auto';
        inputField.style.height = Math.min(inputField.scrollHeight, 120) + 'px';
    });

    inputField.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            // placeholder for send action
        }
    });
</script>

</body>
</html>
